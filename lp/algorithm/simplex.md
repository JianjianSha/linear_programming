# 单纯形法

单纯形法是在疯狂转轴法的基础之上，增加一些关键要素，这些关键要素指导如何更有效地选择转轴点。假设经过若干次转轴操作之后，得到以下单纯形表，

$$\begin{array}{c|c|c}
& \mathbf r &\\
\hline
\mathbf t & A & \mathbf b\\
\hline
& -\mathbf c & v\end{array}$$

并且其中 $\mathbf b \ge \mathbf 0$，那么我们可以立即得到对于 **最大化问题** 的一个可行点：令 $\mathbf r=\mathbf 0$，那么 $\mathbf {t = b}$，此时目标值为 $v$。这是因为转轴操作不改变 $\mathbf u=\mathbf b-A\mathbf x$ 这个约束条件中的等式关系，且 $\mathbf r=\mathbf 0, \ \mathbf {t=b}\ge \mathbf 0$，又因为 $\mathbf {r,t}$ 是交换 $\mathbf {x,u}$ 中部分变量得到，故满足 $\mathbf {x, u} \ge \mathbf 0$ 这个约束条件，所以，$\mathbf r=\mathbf 0$， $\mathbf {t = b}$ 是一个可行点。实际上，这个可行点也是可行区域的一个极点。记原未知向量 $\mathbf x$ 交换出去的变量数量为 $k$，交换出去的变量下标为 $j_1,\cdots,j_k$，未知向量长度为 $n$，那么 

$$x_j=0, \ j=j_{k+1},\cdots, j_n$$ (sim1)

另外 $k$ 个松弛变量 $u_i=0, \ i=i_1,\cdots, i_k$ （因为它们组成了 $\mathbf r$，而 $\mathbf {r=0}$），根据后者有

$$u_i=A_{i,:}\mathbf x-b_i=0, \quad i=i_1,\cdots, i_k$$ (sim2)

根据 {eq}`sim1` 和 {eq}`sim2` 一共有 $n$ 个关于 $\mathbf x$ 的等式（与 $\mathbf u$ 无关），再由约束集的性质可知，此时 $\mathbf x$ 是极点。$\Box$

类似地，如果经过转轴变换，使得 $-\mathbf c \ge \mathbf 0$，那么我们可以令 $\mathbf {t=0}$，从而 $\mathbf r=\mathbf t^{\top}A -\mathbf c=-\mathbf c$，这也是最小化问题的一个可行解。

## 转轴规则

首先考虑已经发现了最大化问题的一个可行解 这种情况。

**情况1：** $\mathbf b \ge \mathbf 0$
```{note}
取最后一个元素值为负的任意一列，记这列为 $j_0$，满足 $-c_{j_0} < 0$。在所有 $a_{i,j_0} > 0$ 的行中，选择比值 $b_i/a_{i,j_0}$ 最小的那一行，如果有多个比值最小，任选其中一行即可，记选择的行为 $i_0$，以 $a_{i_0,j_0}$ 为转轴点进行转轴。
```

对于情况 1，如果找不到这样的转轴点，该怎么办？

第一种可能是：所有列的 $-c_j \ge 0$，那么根据上一篇文章的分析，已经得到最优解和目标最优值。

第二种可能是：在找到某列的 $-c_{j_0} <0$ 之后，这列的所有行元素 $a_{i,j_0} \le 0$，没有正值，也就无法求比值。如果是这种可能，那么 **最大化问题的目标值没有边界** 。为了理解这点，构造一个 $\mathbf r$，满足 $r_{j_0}>0$，且 $r_j=0, \ \forall j \neq j_0$，那么这个 $\mathbf r$ 是最大化问题的一个可行解，因为根据 $\mathbf t = \mathbf b - A\mathbf r$

$$t_i=\sum_{j=1}^n (-a_{i,j}) r_j+b_i=-a_{i,j_0}+b_i \ge 0, \quad \forall i \in [m]$$

满足约束条件。此时，目标值为 

$$\hat {\mathbf c}^{\top} \mathbf x=\hat{\mathbf c}^{\top}\mathbf r+\hat v=\sum c_j r_j+\hat v = c_{j_0}r_{j_0} + \hat v$$

其中 $\hat v$ 是此时表中右下角元素值，与 $\mathbf x, \ \mathbf r$ 均无关，而 $r_{j_0}$ 可以是任意大，所以目标值无上边界。$\Box$

这个转轴规则非常好用，因为：

1. 转轴操作之后，$\mathbf b$ 列仍然保持非负，依然可以得到最大化问题的一个可行解：令 $\mathbf {r=0}$（另一个极点）。
2. 转轴操作之后，目标值不会比原先的小（向着正确方向迭代更新）。

证 1 ：

记转轴之后的单纯形表中各 参量/变量 有 ^ 符号。转轴点为 $a_{i_0,j_0}$，那么根据同行元素除以转轴点值的变换规则，$\hat b_{i_0}=b_{i_0}/a_{i_0,j_0}$，由于 $b_{i_0} \ge 0$，且 $a_{i_0,j_0} >0$，那么 $\hat b_{i_)} \ge 0$。对于不同行 $i \neq i_0$，有

$$\hat b_i=b_i - \frac {b_{i_0}a_{i,j_0}} {a_{i_0,j_0}}$$

如果 $a_{i,j_0} \le 0$，那么 $\hat b_i \ge b_i \ge 0$，如果 $a_{i,j_0} >0$，根据上面的转轴规则，我们选取的是比值最小的那一行作为转轴点，即 $b_i / a_{i,j_0} \ge b_{i_0}/a_{i_0,j_0}$，于是 $b_i \ge b_{i_0}a_{i,j_0}/a_{i_0,j_0}$，故 $\hat b_i \ge 0$ 。 $\Box$

证 2 ：

$\hat v = v - (-c_{j_0})(b_{i_0}/a_{i_0,j_0})$，由于 $-c_{j_0} < 0$，且 $a_{i_0,j_0}>0$，$b_{i_0}\ge 0$，所以 $\hat v \ge v$。$\Box$

如果没有出现情况1，那么该如何选择转轴点？这就是情况2 考虑的问题了。

**情况 2**：部分 $b_i < 0$

```{note}
取第一个为负值的 b，记下标为 $k$，即 $b_k <0$，且 $b_i\ge 0, \ i=1,\cdots k-1$。在第 $k$ 行寻找负值的任一元素，例如 $a_{k,j_0} <0$，比较 $b_k/a_{k,j_0}$ 和 $b_i/a_{i,j_0}$，其中后者需要满足 $b_i \ge 0$ 以及 $a_{i,j_0} >0$（否则不参与比较），选择比值最小的一行（比值最小可为0），记行号为 $i_0$（可能有 $i_0=k$），如果最小比值不止一个，那么任意选择其中一行。以 $a_{i_0,j_0}$ 为转轴点。
```

如果情况 2 中无法实现上述操作该怎么办？唯一的可能是，对于找到的 $b_k <0$，结果 $a_{kj} \ge 0, \ \forall j \in [n]$，如果是这样，那么 **最大化问题没有可行解**。这是因为，对于第 $k$ 行，

$$t_k=b_k-\sum_{j=1}^n a_{kj} r_j$$

根据约束条件，$\mathbf t \ge \mathbf 0$，$\mathbf r \ge \mathbf 0$，所以 $\sum a_{kj} r_j \ge 0$，而 $b_k <0$，所以 $t_k<0$ 矛盾。

情况 2 的操作是为了能得到情况 1，因为

1. 对于非负的 $b_i$，经过情况 2 的转轴操作后，依然保持非负。
2. $b_k$ 变得不会更小（逐步变大，直到转为非负）。

证 1：

对于非负的 b 值，即 $b_i \ge 0$，显然 $i \neq k$。如果 $i=i_0$，那么 $\hat b_{i_0}=b_{i_0}/a_{i_0,j_0} \ge 0$。 如果 $i \neq i_0$，那么

$$\hat b_i=b_i-\frac {a_{i,j_0}b_{i_0}}{a_{i_0,j_0}}$$

由于 $b_{i_0}/a_{i_0,j_0}\ge0$，故 如果 $a_{i,j_0} \le 0$，那么 $\hat b_i \le b_i \ge 0$，如果 $a_{i,j_0} >0$，那么转轴点的行具有最小比例，即 $b_{i_0}/a_{i_0,j_0} \le b_i/a_{i,j_0}$，所以 $a_{i,j_0}b_{i_0}/a_{i_0,j_0} \le b_i$，于是 $\hat b_i \ge 0$ 。$\Box$

证 2：

如果 $k=i_0$，那么 $\hat b_k = b_k /a_{k,j_0} >0$ （分子分母均为负），如果 $k \neq i_0$，那么

$$\hat b_k = b_k - \frac {a_{k,j_0}b_{i_0}}{a_{i_0,j_0}}$$

既然 $a_{k,j_0} <0$，且转轴点比例 $b_{i_0}/a_{i_0,j_0} \ge 0$，于是 $\hat b_k \ge b_k$ 。 $\Box$


## 对偶单纯形法

上面的单纯形法是从最大化问题开始分析。当然也可以从最小化问题开始分析。当出现一个最小化问题的可行解时（即，单纯形表最后一行全部非负，此时令左侧为 0，顶部元素等于最后一行值，得到一个可行解），可以更加有效地（向着最优解的方向）优化这个可行解。

**情况 1**： $-\mathbf c \ge \mathbf 0$

任取最后一列为负值的行，例如 $b_{i_0} <0$，然后对于满足 $a_{i_0,j}<0$ 的列，选择 $-c_j/a_{i_0,j}$ 最大的那一列，由于 $-c_j/a_{i_0,j}<0$，相当于选择最接近 0 的那一列，记列号 为 $j_0$，转轴点为 $a_{i_0,j_0}$ 。

**情况 2**： 部分 $-c_j <0$

取第一个负值 $-c_k < 0$，此时 $-c_j \ge 0, \ \forall j =1,\cdots,k-1$。 在第 $k$ 列中寻找任一正值元素，记行号为 $i_0$，即 $a_{i_0,k} >0$。比较 $-c_k/a_{i_0,k}$ 以及 $-c_j/a_{i_0,j}$ ，其中满足 $-c_j \ge 0$ 以及 $a_{i_0,j} <0$，故 $-c_k/a_{i_0,k}$ 和 $-c_j/a_{i_0,j}$ 均非正，选择最大的，也就是最接近 0 的那个列，记为 $j_0$（可能有 $j_0=k$），以 $a_{i_0,j_0}$ 作为转轴点。